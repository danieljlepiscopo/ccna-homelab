# Quality of Service (QoS) Fundamentals

When it comes to your computer, the Task Manager is your immediate response when an application hangs or becomes unresponsive. You can “end a task” (application), freeing up your computer’s resources to apply to other applications. Similarly, **Quality of Service (QoS)** refers to tools that networking devices use to treat packets on the network differently as they pass through a device. Both act as the “managers” of resources, determining what is and isn’t important based on prioritization.

In this lab, we’ll explore how network devices identify, classify, and prioritize traffic using QoS mechanisms. The CCNA doesn’t go into QoS in depth. Conceptually, making this is a perfect opportunity to apply these ideas of QoS for the homelab.

For this lab, we will go over:

1. **Understanding QoS**
2. **Three Main QoS Models**
3. **Classification and Marking**
4. **Queue Behavior**
5. **Traffic Shaping and Policing**
6. **Congestion Avoidance**
7. **Wrap-Up**

## **Understanding QoS**

If we treated all traffic equally, our idea of phone calls, video calls, and interactive traffic would struggle to work effectively. This concept is called **Best Effort Delivery**, meaning there are no guarantees that traffic will be delivered reliably. This comes to our main idea of QoS: all traffic on a network is not equal, and we need to prioritize it. 

There are four characteristics of network traffic:

- **Bandwidth** - The speed/capacity of a link, and how many bits per second can be sent.
- **Delay** - The time it takes to send/receive packets back, to and from a host.
- **Jitter** - Variation in one-way delay between two applications.
- **Loss** - Total number of lost packets (usually a percentage).

Let’s take a look at the different types of traffic that QoS should affect on a network:

| **Traffic Type** | **Sensitivity** | **Example** |
| --- | --- | --- |
| Voice | Delay & Jitter | VoIP Phones |
| Video | Delay & Loss | Zoom, FaceTime |
| Critical Data | Loss | Database Traffic |
| Best Effort | None | Web Browsing, Email |

With a better understanding of how different types of traffic are affected by their sensitivity to traffic characteristics, we can see why QoS is crucial for ensuring reliable delivery of priority traffic on the network. Let’s now take a look at the different QoS models there are and how they may or may not apply to networks today.

## **Three Main QoS Models**

Right now, there are three different QoS models: **Best Effort**, **Integrated Services (IntServ)**, and **Differentiated Services (DiffServ)**. Let me explain the differences between these models:

- **Best Effort**: Providing no QoS, packets are treated the same with no bounds on delay, jitter, or loss.
- **Integrated Services (IntServ)**: Great for resource reservation, allowing specific amounts of bandwidth using the protocol **Resource Reservation Protocol (RSVP)**. Not scalable, so it isn’t used much today.
- **Differentiated Services (DiffServ)**: A modern, scalable, and flexible model that classifies traffic into different classes using the **Differentiated Services Code Points (DSCP)** protocol to mark packets.

Here’s a summary table comparing each of the QoS models:

| **Model** | **Description** | **Example** |
| --- | --- | --- |
| Best-Effort | No QoS - traffic is treated equally. | Default Networks |
| Integrated Services (IntServ) | Per-flow Reservations using RSVP | Older VoIP/Legacy WAN |
| Differentiated Services (DiffServ) | Traffic marked and prioritized by DSCP | Modern Enterprise Networks |

Since DiffServ is the most utilized QoS model today, and the main focal point of the CCNA, we will use this model for further QoS concepts. Let’s take a look next at how marking works with DiffServ.

## **Classification and Marking**

DiffServ utilizes classification and marking to classify packets, based on their header contents, and then marks them by changing bits in their specified header:

- **Classification**: The process of matching fields in a message to make a QoS action.
    - Similar to how an ACL matches packet headers (classify), and then has the action to choose if a packet needs to be discarded.
- **Marking**: QoS tools will change one or more header fields, setting a value in the header to differentiate the packet for QoS processing.

The way that DiffServ does it is by DSCP (IP marking) and CoS (Ethernet marking) for Layer 3 and Layer 2, respectively. Let’s take a look at each concept next:

### CoS Marking

Existing in the 802.1Q header, only existing on trunked links, we have the fields that make up the Ethernet frame:

- **Class of Service (CoS)**: Sitting in the third byte of the 4-byte 802.1Q header, CoS supplies eight possible values to mark.

Here’s a look at an Ethernet frame with the 802.1Q header:

<center>
  <img width="400" height="500" alt="802.1q_header" class="center" src="https://github.com/user-attachments/assets/c06855bd-b832-4fb6-9b66-dd00de865c70" />
</center>

- Inside the frame, we have the two main fields:
    - **Tag Protocol Identifier (TPID)**
    - **Tag Control Information (TCI)**
    

- The TCI is a 2-byte, or 16-bit field that is comprised of these three fields:
    - **Priority Code Point (PCP)**
    - **Drop Eligible Indicator (DEI)**
    - **VLAN Identifier (VLAN ID)**

Without going into major depth, PCP is a 3-bit field that is utilized to mark IP packet headers for CoS. Depending on the packet value determines what type of priority is given to the Ethernet frame entirely. However, what if we’re not traveling over an 802.1Q link? That’s where QoS marking on the Layer 3 comes into play.

# IPv6 Routing

For this lab, we will be configuring IPv6 routing to allow devices to route traffic with the newer Internet Protocol (IP) version 6. IPv6 is needed today in enterprise networks because of the shift away from IPv4’s limited address space, allowing IPv6 to be the eventual handoff, as well as working alongside IPv4 for the time being. This lab will have these main steps listed:

1. **Addressing Strategy**
2. **Dual-Stack SDM**
3. **Interface Configuration**
4. **Dynamic Routing with OSPFv3**
5. **Configure Router IDs**
6. **Verify**
7. **Wrap-Up**

When we’re done, OSPFv3 will dynamically route IPv6 across the same topology as IPv4. Let’s get started!

### Addressing Strategy

In IPv6, there are public and private IPv4 addresses:

1. **Global Unicast Addresses (GUAs)** - Registered IPv6 addresses that organizations must register with a numbering authority to function correctly.
2. **Unique Local Addresses (ULAs)** - Similar to private IPv4 addresses, multiple organizations would be able to use these without registering them.

For my homelab, we will use ULA addresses. There are different prefix lengths we may use, but to match our `192.168.x.x` topology, we will use the `fdd00::/8` prefix. Which will look like this for each key subnet:

| Device | Interface | IPv6 Address | Prefix | Notes |
| --- | --- | --- | --- | --- |
| **PC** | NIC | fd00:1:0:1::10 | /64 | VLAN 99 subnet |
| **SW1** | Fa0/5 | fd00:1:0:1::1 | /64 | Default gateway for PCs |
| **SW2** | VLAN 99 | fd00:1:0:1::15 | /64 | Default gateway for PCs |
| **SW3** | VLAN 99 | fd00:1:0:1::16 | /64 | Default gateway for PCs |
| **R1** | Gi0/1 | fd00:1:0:1::2 | /64 | Connected to SW1 VLAN 99 |
| **R1** | Gi0/0 | fd00:1:0:3::1 | /64 | Point-to-point to R2 |
| **R1** | Lo0 | fd00:1:0:2::1 | /128 | Loopback ID |
| **R2** | Gi0/1 | fd00:1:0:3::2 | /64 | Point-to-point to R1 |
| **R2** | Gi0/0 | fd00:1:0:5::1 | /64 | Point-to-point to R3 |
| **R2** | Lo0 | fd00:1:0:4::1 | /128 | Loopback ID |
| **R3** | Gi0/1 | fd00:1:0:5::2 | /64 | Point-to-point to R2 |
| **R3** | Lo0 | fd00:1:0:6::1 | /128 | Loopback ID |
- Similar to my P2P IPs for IPv4, we will be using the `/64` (`/30` for IPv4) prefix-length, even though a `/126` (`/31` for IPv4) is more efficient and wastes less IP space. This should be fine for understanding and may be updated later, if I so choose.
- Loopback IPs for IPv6 will be a `/128` (similar to a `/32` for IPv4) for a unique identification.

Now that we know our allocated IPv6 addresses, let’s set the new SDN for all three of my switches.

## **Dual-Stack SDM**

For my switches, we’ll need to configure them to enable IPv6 support at the global level. To do that, we’ll need to change the SDM (Switched Data Model) template to support IPv4 and IPv6. 

**SW1, SW2, and SW3:**

To check the current SDM, use this command:

```bash
show sdm prefer
```

As you can see by my output, it’s saying that it’s “desktop default”, so we’ll need to change that:

<center>
  <img width="400" height="500" alt="sw1_default_desktop" class="center" src="https://github.com/user-attachments/assets/2acd5f53-af56-457a-9593-96a5e56c1583" />
</center>
<center>
  <img width="400" height="500" alt="sw2_and_sw3_default" class="center" src="https://github.com/user-attachments/assets/32d5e8e2-63fc-4efa-8bc8-cddd64cf09db" />
</center>

To set the dual-stack SDM, use this command:

**SW1:**

```bash
conf t
!
sdm prefer dual-ipv4-and-ipv6 routing
!
end
wr
reload
```

**SW2 and SW3:**

```bash
conf t
!
sdm prefer dual-ipv4-and-ipv6 default
!
end
wr
reload
```

- Make sure you notice the differences between SW1’s configuration `routing` and SW2/SW3’s `default` keyword. This is because SW1 is a Layer 3 switch, and the other two aren’t.
- After setting the dual IPv4 and IPv6 stack, reload the switches.

Once the device is reloaded, verify again. 

```bash
show sdm prefer
```

Now they should look like this:

<center>
  <img width="400" height="500" alt="sw1_desktop_ipv4_and_ipv6_routing" class="center" src="https://github.com/user-attachments/assets/d09dd230-aa17-46bc-a569-5cd13ee6f9dd" />
</center>
<center>
  <img width="400" height="500" alt="sw2_sw3_duel_ipv4_ipv6_default" class="center" src="https://github.com/user-attachments/assets/8d80c756-448b-4d46-b378-dc78e610a716" />
</center>

Now that all of my switches are globally configured with IPv6, let’s continue with configuring interfaces and loopbacks!

### **VLAN/Interface/Loopback IPv6 Configuration**

Configuring IPv6 IPs on interfaces, loopbacks, and VLANs isn’t difficult at all. We’ll just add the IPv6 `/64` IPs to either the management VLAN 99 (for SW2 and SW3), as well as the P2P IPs and loopbacks of the routers. Let’s take a look at the configuration for everything:

**PC:**

<center>
  <img width="400" height="500" alt="pc_config" class="center" src="https://github.com/user-attachments/assets/90b51b05-8282-452b-b12a-787de4ad1bc0" />
</center>
<center>
  <img width="400" height="500" alt="ip_config_extended" class="center" src="https://github.com/user-attachments/assets/f63c09cb-dd98-4148-bc57-cb9a7660892f" />
</center>

- For my PC, we’ll need to enable IPv6 in my network settings and then apply the IPv6 address, subnet prefix length, and the gateway to SW1
- The Preferred DNS, I put Google’s primary DNS `2001:4860:4860::8888`, similar to the `8.8.8.8` we added for IPv4.

**SW1:**

```bash
conf t
!
interface vlan 99
 ipv6 address FD00:1:0:1::1/64
 ipv6 enable
exit
!
end
wr

```

**SW2:**

```bash
conf t
!
interface vlan 99
 ipv6 address fd00:1:0:1::15/64
 ipv6 enable
exit
!
end
wr
```

**SW3:**

```bash
conf t
!
interface vlan 99
 ipv6 address fd00:1:0:1::16/64
 ipv6 enable
exit
!
end
wr
```

**R1:**

```bash
conf t
!
interface Lo0
 ipv6 address fd00:1:0:2::1/128
exit
!
interface Gi0/1
 ipv6 address fd00:1:0:1::2/64
 ipv6 enable
exit
!
interface Gi0/0
 ipv6 address fd00:1:0:3::1/64
 ipv6 enable
exit
!
end
wr
```

**R2:**

```bash
conf t
!
interface Lo0
 ipv6 address fd00:1:0:4::1/128
exit
!
interface Gi0/1
 ipv6 address fd00:1:0:3::2/64
 ipv6 enable
exit
!
interface Gi0/0
 ipv6 address fd00:1:0:5::1/64
 ipv6 enable
exit
!
end
wr
```

**R3:**

```bash
conf t
!
interface Lo0
 ipv6 address fd00:1:0:6::1/128
exit
!
interface Gi0/1
 ipv6 address fd00:1:0:5::2/64
 ipv6 enable
exit
!
end
wr
```

- Be sure to add the `ipv6 enable` command for the interfaces to generate a link-local address, which helps IPv6 be able to route traffic more efficiently than IPv4.
- You won’t need that `ipv6 enable` command on loopback interfaces.

After interface/loopbacks are configured with an IPv6 interface, we’re now ready to enable IPv6 dynamic routing with OSPFv3.

### Dynamic Routing with OSPFv3

Since we’ve already configured OSPFv2 in our last lab, for IPv6 dynamic routing to work with the homelab, we’ll need to configure OSPFv3 on each of the router interfaces and SW1’s VLAN 99, instead of using the `network` statement from last time - this is just how OSPFv3 is configured.

We’ll also need to globally configure OSPFv3 on each of the routers and my L3 switch. 

**SW1:**

```bash
conf t
!
ipv6 unicast-routing
!
interface vlan 99
 ipv6 ospf 1 area 0
exit
!
end
wr
```

**R1:**

```bash
conf t
!
ipv6 unicast-routing
!
interface Gi0/1
 ipv6 ospf 1 area 0
exit
!
interface Gi0/0
 ipv6 ospf 1 area 0
exit
!
end
wr
```

**R2:**

```bash
conf t
!
ipv6 unicast-routing
!
interface Gi0/1
 ipv6 ospf 1 area 0
exit
!
interface Gi0/0
 ipv6 ospf 1 area 0
exit
!
end
wr
```

**R3:**

```bash
conf t
!
ipv6 unicast-routing
!
interface Gi0/1
 ipv6 ospf 1 area 0
exit
!
end
wr
```

### **Configure Router IDs**

Incredibly similar to how we configured OSPFv2 router IDs, we’ll have to do the same thing for OSPFv3, but the router ID will take the same 32-bit IPv4 router ID (for simplicity in my home lab). It’s a little confusing, since this is IPv6, but that’s just how you configure it.

**SW1:**

```bash
conf t
!
ipv6 router ospf 1
 router-id 192.168.1.1
 passive-interface Lo0
exit
!
end
wr
```

**R1:**

```bash
conf t
!
ipv6 router ospf 1
 router-id 192.168.2.1
 passive-interface Lo0
exit
!
end
wr
```

**R2:**

```bash
conf t
!
ipv6 router ospf 1
 router-id 192.168.4.1
 passive-interface Lo0
exit
!
end
wr
```

**R3:**

```bash
conf t

!
ipv6 router ospf 1
 router-id 192.168.6.1
 passive-interface Lo0
exit
!
end
wr
```

Let’s break down these commands:

- `ipv6 unicast-routing`: Allows IPv6 routing globally on devices.
- `ipv6 router ospf [process-id]`:  Enables OSPFv3 with an autonomous system (1 in this case).
- `router-id`: The router ID is a unique identifier for the OSPF router in the network.
- `passive-interface Loopback0`: Prevents Hello messages from being sent out the loopback interface.

After this, everything with OSPFv3 should be completed. Now, let’s verify to make sure it looks good on all the routing devices.

### Verify

Everything should now be working properly. Let’s run a few verification commands to double-check that the IPv6 IPs are configured and OSPFv3 is configured on all of the routers and my L3 switch.

1. **Verify Interface IPv6 Addressing**
2. **Verify OSPFv3 Router IDs**
3. **Check OSPFv3 Neighbor Adjacencies**
4. **Verify OSPFv3 Routes in the Routing Table**
5. **Test Connectivity (Ping & Traceroute)**
6. **IPV6 OSPFv3 Route Checks**

Let’s breakdown each of these steps for easier readability.

**1. Verify Interface IPv6 Addressing**

Check that all devices have their correct IPv6 addresses on the proper interfaces.

**On SW1, SW2, SW3, R1–R3:**

```bash
show ipv6 interface brief
```

You should see:

1. The correct IPv6 address compared to the addressing plan.
2. Interfaces are all `up/up`
3. `ipv6 enable` shows as yes.

**2. Verify OSPFv3 Router IDs**

Check that each device has the correct OSPFv3 router ID:

```bash
show ipv6 ospf
! or
show ipv6 ospf 1
```

You should see:

1. All of the OSPFv3 router IDs we configured
    - SW1: `192.168.1.1`
    - R1: `192.168.2.1`
    - R2: `192.168.4.1`
    - R3: `192.168.6.1`

**3. Check OSPFv3 Neighbor Adjacencies**

Make sure all point-to-point links have formed OSPFv3 neighbor relationships:

**R1**, **R2**, and **R3**:

```bash
show ipv6 ospf neighbor
```

You should see:

1. Each interface is connected to another router in the `FULL` state.
2. Neighbor Router ID matches your addressing table.
3. Only P2P interfaces are forming neighbors (loopbacks shouldn’t)

**4. Verify OSPFv3 Routes in the Routing Table**

Check that all networks are being learned dynamically via OSPFv3:

```bash
show ipv6 route
```

You should see:

1. OSPFv3 routes will appear as an `O` in the IPv6 routing table.
2. Loopback networks of R1, R2, and R3 should be present on all routers.

**5. Test Connectivity (Ping & Traceroute)**

Ping across different subnets to verify end-to-end connectivity on PC and devices:

**PC:**

```bash
tracecert fd00:1:0:6::1

ping fd00:1:0:1::1    ! SW1
ping fd00:1:0:1::15   ! SW2
ping fd00:1:0:1::16   ! SW3
ping fd00:1:0:2::1    ! R1 L0
ping fd00:1:0:4::1    ! R2 L0
ping fd00:1:0:6::1    ! R3 L0
```

**SW1:**

```bash
ping ipv6 fd00:1:0:1::10   ! PC
ping ipv6 fd00:1:0:1::15   ! SW2
ping ipv6 fd00:1:0:1::16   ! SW3
ping ipv6 fd00:1:0:2::1    ! R1 Lo0
ping ipv6 fd00:1:0:4::1    ! R2 Lo0
ping ipv6 fd00:1:0:6::1    ! R3 Lo0
```

**SW2:**

```bash
ping ipv6 fd00:1:0:1::10   ! PC
ping ipv6 fd00:1:0:1::1    ! SW1
ping ipv6 fd00:1:0:1::16   ! SW3
ping ipv6 fd00:1:0:2::1    ! R1 Lo0
ping ipv6 fd00:1:0:4::1    ! R2 Lo0
ping ipv6 fd00:1:0:6::1    ! R3 Lo0
```

**SW3:**

```bash
ping ipv6 fd00:1:0:1::10   ! PC
ping ipv6 fd00:1:0:1::1    ! SW1
ping ipv6 fd00:1:0:1::15   ! SW2
ping ipv6 fd00:1:0:2::1    ! R1 Lo0
ping ipv6 fd00:1:0:4::1    ! R2 Lo0
ping ipv6 fd00:1:0:6::1    ! R3 Lo0
```

**R1:**

```bash
ping ipv6 fd00:1:0:1::10   ! PC
ping ipv6 fd00:1:0:1::1    ! SW1
ping ipv6 fd00:1:0:1::15   ! SW2
ping ipv6 fd00:1:0:1::16   ! SW3
ping ipv6 fd00:1:0:4::1    ! R2 Lo0
ping ipv6 fd00:1:0:6::1    ! R3 Lo0
```

**R2:**

```bash
ping ipv6 fd00:1:0:1::10   ! PC
ping ipv6 fd00:1:0:1::1    ! SW1
ping ipv6 fd00:1:0:1::15   ! SW2
ping ipv6 fd00:1:0:1::16   ! SW3
ping ipv6 fd00:1:0:2::1    ! R1 Lo0
ping ipv6 fd00:1:0:6::1    ! R3 Lo0
```

**R3:**

```bash
ping ipv6 fd00:1:0:1::10   ! PC
ping ipv6 fd00:1:0:1::1    ! SW1
ping ipv6 fd00:1:0:1::15   ! SW2
ping ipv6 fd00:1:0:1::16   ! SW3
ping ipv6 fd00:1:0:2::1    ! R1 Lo0
ping ipv6 fd00:1:0:4::1    ! R2 Lo0
```

After pings come across good, and connectivity it there. Let’s do some final IPv6 OSPFv3 route checks to close this out.

1. **IPV6 OSPFv3 Route Checks**

Lastly, let’s mare sure that OSPFv3 is looking good between every L3 device:

**SW1, R1, R2, and R3:**

```bash
show ipv6 interface brief
show ipv6 ospf neighbor
show ipv6 route ospf
```

- As long as IPV6 OSPF routes are added to each device, we should be set with connectivity and subnet relationships.

## Wrap-Up

To wrap up this lab, we now have IPV6 OSPFv3 on each of the L3 devices! 

Duel stack routing, OPFv2 and OSPFv3, are running in parallel on the devices! Thus mirroring  a realistic enterprise topology. Since IPV4 will one day phase out, IPV6 will dominate the future, so representing that though my current home lab is amazing to replicate. The future for IP is shifting day-by-day, so even with the current unknown landscape of it now, this homelab is prepared for the unknow and will be sustainable for the for-seeable future!

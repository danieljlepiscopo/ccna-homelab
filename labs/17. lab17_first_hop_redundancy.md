# First Hop Redundancy Protocols (FHRP) (HSRP, VRRP, and GLBP)

When it comes to networking, one crucial idea is how to prevent Single Points of Failure (SPOF) from causing an outage to happen, especially for hosts that rely on that connectivity. Using redundancy, such as redundant devices or links, can help limit the number of SPOFs in a network, if not eliminate them. However, we also need a way for our hosts to have redundancy to their gateways as well.

For this lab, we will gain an understanding of why we need **First Hop Redundancy Protocols (FHRP)**, and then go through each of the three main FHRPs: **Hot Standby Router Protocol (HSRP**), **Virtual Router Redundancy Protocol (VRRP)**, and **Gateway Load Balancing Protocol (GLBP)**.

In this lab, we will go over:

1. **What is FHRP?**
2. **FHRP Overview: HSRP, VRRP, and GLBP**
3. **Hot Standby Router Protocol (HSRP)**
4. **Virtual Router Redundancy Protocol (VRRP)**
5. **Gateway Load Balancing Protocol (GLBP)**
6. **Wrap-Up**

## What is FHRP?

Let’s take a step back and look at a network with SPOFs in it:

<center>
  <img width="400" height="400" alt="spof" class="center" src="https://github.com/user-attachments/assets/444158f3-9741-4868-8694-1f93b30cd33c" />
</center>

- As you can see, if one of these links goes down, hosts in the subnet `10.1.1.0/24` won’t be able to connect to the devices/hosts in the next subnet.

Here is where FHRP fixes this issue, but let’s get a definition of what FHRP even is:

- **First Hop Redundancy Protocol (FHRP)**: is a collection of protocols that provides redundancy to gateway routers in a subnet.

Seems easy enough, let’s go ahead and add in redundant devices/links to this example topology next:

<center>
  <img width="400" height="400" alt="redundant_links" class="center" src="https://github.com/user-attachments/assets/0147b573-82cf-44a1-b8d2-21181f3794df" />
</center>

So, now that we have a redundant LAN, where hosts have to choose between two different routers to get to the WAN, how do we tell the hosts which router to choose? What if one router goes down? How do we tell the hosts to choose the active router that’s still up instead of the one that’s down?

With FHRP, we’ll use a virtual IP address and a virtual MAC address on both of the routers.

- **Virtual IP Address (VIP)**: The default gateway IP address for all of the devices in the subnet.
- **Virtual MAC Address (VMAC)**: The virtual MAC address that the router will automatically create.

From here, once the router is considered the active router (gateway router), the other one becomes the standby router. The hosts will point to the active router, and if something happens to it, FHRP messages that the routers use to communicate with one another will tell the hosts to swap to the alternative gateway. Pretty cool, right? Next, let’s take a look at all of the available FHRP options that there currently are and how they compare with one another.

## **FHRP Overview: HSRP, VRRP, and GLBP**

For the overview of all three FHRP options:

- **Hot Standby Router Protocol (HSRP)**
- **Virtual Router Redundancy Protocol (VRRP)**
- **Gateway Load Balancing Protocol (GLBP)**

Cisco’s proprietary FHRP is called Hot Standby Router Protocol (HSRP). Later, similar protocols were developed, for instance, Virtual Router Redundancy Protocol (VRRP), which is used for devices communicating with each other from different vendors. Lastly, we have Cisco’s more developed FHRP option, Gateway Load Balancing Protocol (GLBP), which is a little more specialized.

I will break down each of these different FHRPs next, and even go through the configuration as well. Here’s a table of the three options:

| **Acronym** | **Full Name** | **Origin** | **Redundancy Approach** |
| --- | --- | --- | --- |
| HSRP | Hot Standby Router Protocol | Cisco | Active/Standby |
| VRRP | Virtual Router Redundancy Protocol | RFC 5798 | Master/Backup |
| GLBP | Gateway Load Balancing Protocol | Cisco | Load Balanced |

## Hot Standby Router Protocol (HSRP)

HSRP is one of the most commonly configured FHRPs, since Cisco was the first to create such a concept in computer networking.

### States

HSRP works with an active/standby model (sometimes referred to as *active/passive*):

- **HSRP Active**: The active router is the gateway for hosts.
- **HSRP Standby**: The router waiting to take over the active router.
- **HSRP Priority**: The router with the highest priority wins and becomes the active router.
    - If priorities tie, the router with the lowest IP address wins instead.

After the election of the HSRP priority router, the VIP and VMAC are applied to it. 

### Messages

HSRP enables the failover of the next-hop device if the original active device fails. It does this by sending HSRP multicast messages to the routers:

- **Hello**: Sent between the active/standby devices every three seconds.
- **Resign**: Sent by the active router when it’s about to release its active role.
- **Coup**: Used when the standby router wants to become the active router.

These messages maintain HSRP, as well as inform the routers of their states and if they need to be updated.

### Interface Tracking/Versions

**Interface Tracking**

IOS allows for interface tracking, which tracks the interface state, IP routing table, and a bunch of other objects/indicators. When the tracked interface or objects fail, HSRP will reduce the router’s priority. As an example for this, let’s take a look at this image:

<center>
  <img width="400" height="400" alt="hsrp_interface_tracking" class="center" src="https://github.com/user-attachments/assets/87970f81-7e78-4e9d-835a-5a74d6d96c6c" />
</center>

- If R1’s WAN link went down, and R2’s WAN was still functional, traffic would be sent through R1 to R2, which isn’t exactly what we want. We want traffic to just go to R2 → WAN.

This really comes down to the WAN link failing, so R1 needs to be able to notice that and lower its own priority level so R2 becomes the active router. Once the WAN link of R1 becomes active again, R1 will notice this change and then revert the changes, becoming the active router again.

**Versions**

HSRP has two different versions: **HSRPv1** and **HSRPv2**. HSRPv2 allows for IPv6 support, and it has faster convergence using shorter Hello timers. Because of these updates, it’s better to use HSRPv2 in your network if you’re going to use it. 

Below, I’ll list the differences between these two versions of HSRP:

| Feaure | **HSRPv1** | **HSRPv2** |
| --- | --- | --- |
| IPv6 Support | No | Yes |
| Hello Timer Convergence | Seconds | Miliseconds |
| Range of Groups | 0 - 255 | 0 - 4095 |
| Virtual MAC Address | 0000.0C07.ACXX (XX = Group #) | 0000.0C9F.FXXX (XXX = Group#) |
| IPv4 Multicast Address | 224.0.0.4 | 224.0.0.102 |
- It’s essential to note that routers/switches must use the same HSRP version; otherwise, they won’t understand each other’s multicast messages and will ignore one another.

### **HSRP Configuration**

For the configuration of HSRP, as well as my homelab topology, it makes sense to make:

1. **SW1 the Active HSRP Router**
2. **R1 the Standby HSRP Router**

Since I technically don’t have dual-distribution routers/switches, I only have the one SW1 (my L3 core/distribution switch), FHRP will not be a correct textbook “redundancy pair”, but it’ll be enough to have HSRP and other FHRP behaviors work. 

To do this, I will set the configuration as:

**SW1**

```bash
conf t
!
interface Vlan99
 standby version 2
 standby 1 ip 192.168.1.254
 standby 1 priority 120
 standby 1 preempt
exit
!
end
wr
```

Command Breakdown:

- `standby version 2`: Sets HSRP to use HSRPv2 instead of HSRPv1.
- `standby 1 ip 192.168.1.254`
    - `standby 1`: HSRP group number that all routers in the group must be part of.
    - `ip 192.168.1.254`: The virtual IP (VIP) that the host will use for their default gateway.
- `standby 1 priority 120`: Assigning the router priority. Whichever router has the highest priority is the active router (default priority is 100).
- `standby 1 preempt`: Allowing the router to take back the active role, if it is the highest priority.

**R1**

```bash
conf t
!
interface GigabitEthernet0/1
 standby version 2
 standby 1 ip 192.168.1.254
 standby 1 priority 100
 standby 1 preempt
exit
!
end
wr
```

**Verify**

```bash
show standby brief
show standby
```

- We should see that SW1 is our active router and R1 is our standby router.

With this configuration, if we did a failover test, where we could shut down either Gi0/1 on R1 or VLAN99 on SW1, HSRP would take over and swap the roles. The idea is simple enough to state for us to move onto the other FHRP options, with VRRP up next.

**HSRP Removal**

In order for me to demonstrate each of the FHRP options, we’ll need to remove each one after configuration. We shouldn’t configure multiple at the same time because FHRPs aren’t meant to run together on the same subnet.

**SW1**

```bash
conf t
!
interface Vlan99
 no standby version 2
 no standby 1 ip 192.168.1.254
 no standby 1 priority 120
 no standby 1 preempt
exit
!
end
wr
```

R1

```bash
conf t
!
interface GigabitEthernet0/1
 no standby version 2
 no standby 1 ip 192.168.1.254
 no standby 1 priority 100
 no standby 1 preempt
exit
!
end
wr
```

Now with HSRPv2 removed, let’s move on to VRRP, which will give us some insight on neutral enterprise vendor topologies. I will add HSRPv2 to these devices as the standard in my topology, after demonstrating the others.

## Virtual Router Redundancy Protocol (VRRP)

The IETF created VRRP in the 1990s, and since then there have been three different versions of it, notably VRRPv3 as the newest version.

### **VRRP Overview**

HSRP and VRRP are practically identical protocols, supporting the same functions, however there’s a major variation between the two:

- **Two or more routers form a group within one subnet.**
- **VRRP defines a virtual IP (VIP) and virtual MAC (VMAC).**
- **Selects a master and backup router (similar to active/standby in HSRP).**

The difference between them is that VRRP isn’t a Cisco proprietary protocol like HSRP. VRRP is used to create FHRP with routers from different vendors, so you could have a Cisco router and a Juniper router understand one another and determine the master/backup roles.

### **VRRP Configuration**

VRRP is just as simple to configure as HSRP, here’s how it looks:

**SW1**

```bash
conf t
!
interface Vlan99
 vrrp 1 ip 192.168.1.254
 vrrp 1 priority 120
 vrrp 1 preempt
exit
!
end
wr
```

Command Breakdown:

- The syntax is the exact same as HSRP, the only difference is we’ll be using the `vrrp` keyword instead of `standby`.

**R1**

```bash
conf t
!
interface GigabitEthernet0/1
 vrrp 1 ip 192.168.1.254
 vrrp 1 priority 100
 vrrp 1 preempt
exit
!
end
wr
```

**Verify**

```bash
show vrrp
```

- With this command we should see the devices stating the master/backup relationship.
- My devices support VRRPv2 but not VRRPv3, so no IPv6 redundant gateway.

Similar to HSRP, if we simulated one of the links going down, we’d see the master/backup switch between the devices. This is what it looks like on my SW1, currently:

```bash
SW1#show vrrp
Vlan99 - Group 1
State is Master
Virtual IP address is 192.168.1.254
Virtual MAC address is 0000.5e00.0101
Advertisement interval is 1.000 sec
Preemption enabled
Priority is 120
Master Router is 192.168.1.1 (local), priority is 120
Master Advertisement interval is 1.000 sec
Master Down interval is 3.531 sec
```

**VRRP Removal**

**SW1**

```bash
conf t
!
interface Vlan99
 no vrrp 1
 no vrrp 1 ip 192.168.1.254
 no vrrp 1 priority 120
 no vrrp 1 preempt
exit
!
end
wr
```

**R1**

```bash
conf t
!
interface GigabitEthernet0/1
 no vrrp 1 ip 192.168.1.254
 no vrrp 1 priority 100
 no vrrp 1 preempt
exit
!
end
wr
```

VRRP is perfect for a vendor neutral enterprise network, where different vendor devices must be able to communicate with one another effectively. Next, let’s take a look at GLBP and it’s load balancing capabilities.

## Gateway Load Balancing Protocol (GLBP)

GLBP is another Cisco proprietary protocol that came about after HSRP and VRRP. It provides practically the same benefits as HSRP, but with better internals for load balancing between routers, hence the “Load Balancing” in the name.

### **GLBP Overview**

Similar to how VRRP is similar to HSRP, let’s see the similarities and differences between GLBP:

**Similarities**

1. Uses a virtual IP (VIP), where endpoints use this as their default gateway.
2. The “best router” is considered the one with the highest priority.
3. Supports interface tracking, which dynamically lowers a router’s priority in case of a link failure.
4. Sends multicast messages for router communication.

**Differences**

1. The multicast messages use a different address: **224.0.0.102**.
2. GLBP uses a unique VMAC per GLBP router (MAC Address pattern 0007.b40x.xxrr):
    1. **Router 1**: 0007.b40**0**.**1401** (decimal group 20, hex group 14, and assigned router 01)
    2. **Router 2**: 0007.b40**0**.**1402** (decimal group 20, hex group 14, and assigned router 02)

GLBP load balances between two different default routers in a subnet, forwarding packets to the two different VMAC devices, while sharing the same VIP. Thus spreading the workload between the routers using two major concepts:

- **GLBP Active Virtual Gateway (AVG)**: One router handles all of the ARP functions for the VIP.
- **GLBP Active Virtual Forwarder (AVF)**: All the routers serve as the AVF, ready to receive Ethernet frames assigned to their VMAC and route the packets.

With this knowledge, let’s go ahead and configure GLBP on SW1 and R1 of my homelab.

### **GLBP Configuration**

**SW1**

```bash
conf t
!
interface Vlan99
 glbp 1 ip 192.168.1.254
 glbp 1 priority 120
 glbp 1 preempt
!
end
wr
```

Command Breakdown:

- Practically the exact same configuration of HSRP and VRRP, but with the `glbp` keyword in the configuration.

**R1**

```bash
conf t
!
interface GigabitEthernet0/1
 glbp 1 ip 192.168.1.254
 glbp 1 priority 110
 glbp 1 preempt
!
end
wr
```

**Verify**

```bash
show glbp
show glbp brief
```

- My SW1 doesn’t take the GLBP configuration, but we should see SW1 as the AVG for group 1, there are two AVFs (one per router), and each with a different VMAC.

**GLBP Removal / Re-adding HSRPv2**

Now with our understanding of GLBP, let’s go ahead and re-add HSRPv2 to our homelab, making it more “enterprise friendly,” especially since we don’t have another vendor in the home lab or a strong need for GLBP in it either.

**SW1**

```bash
conf t
!
interface Vlan99
 standby version 2
 standby 1 ip 192.168.1.254
 standby 1 priority 120
 standby 1 preempt
exit
!
end
wr
```

**R1**

```bash
conf t
!
interface GigabitEthernet0/1
 no glbp 1 ip 192.168.1.254
 no glbp 1 priority 110
 no glbp 1 preempt
 standby version 2
 standby 1 ip 192.168.1.254
 standby 1 priority 100
 standby 1 preempt
exit
!
end
wr
```

**Verify**

```bash
show standby brief
show standby
```

Now that we’ve seen all of the FHRP options and HSRPv2 has been added back, we’re now able to finish up with lab with our conclusion.

## Wrap-Up

FHRP is an incredibly important failover concept and helps remove SPOFs from a network. Without it, it would be detrimental for end-hosts connected in a subnet, as well as being able to continue operations without much of any inconvenience. Ultimately, that’s the best thing about FHRP. It’s similar to civil engineering, where you shouldn’t really know much about it unless something goes terribly wrong. FHRP is the silent, behind-closed-doors concept that is best kept abstract and less about being “well known” for its major networking accomplishments.
